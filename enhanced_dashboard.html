<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>🚀 Enhanced Telecom AI System Dashboard</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/date-fns@2.29.3/index.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: #333;
            min-height: 100vh;
        }

        .header {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            padding: 20px;
            text-align: center;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .header h1 {
            color: #2c3e50;
            font-size: 2.5em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.1);
        }

        .header p {
            color: #7f8c8d;
            font-size: 1.2em;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        .status-bar {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .status-card {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 20px;
            text-align: center;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }

        .status-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 12px 40px rgba(0, 0, 0, 0.15);
        }

        .status-card h3 {
            color: #2c3e50;
            margin-bottom: 10px;
            font-size: 1.1em;
        }

        .status-card .value {
            font-size: 2em;
            font-weight: bold;
            color: #3498db;
            margin-bottom: 5px;
        }

        .status-card .label {
            color: #7f8c8d;
            font-size: 0.9em;
        }

        .agents-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .agent-card {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }

        .agent-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 12px 40px rgba(0, 0, 0, 0.15);
        }

        .agent-header {
            display: flex;
            align-items: center;
            margin-bottom: 20px;
        }

        .agent-icon {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5em;
            margin-right: 15px;
            color: white;
        }

        .qos-icon { background: linear-gradient(45deg, #e74c3c, #c0392b); }
        .failure-icon { background: linear-gradient(45deg, #f39c12, #e67e22); }
        .traffic-icon { background: linear-gradient(45deg, #3498db, #2980b9); }
        .energy-icon { background: linear-gradient(45deg, #27ae60, #229954); }
        .security-icon { background: linear-gradient(45deg, #9b59b6, #8e44ad); }
        .quality-icon { background: linear-gradient(45deg, #1abc9c, #16a085); }

        .agent-title {
            font-size: 1.3em;
            font-weight: bold;
            color: #2c3e50;
        }

        .agent-subtitle {
            color: #7f8c8d;
            font-size: 0.9em;
        }

        .metrics-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin-bottom: 20px;
        }

        .metric {
            text-align: center;
            padding: 15px;
            background: rgba(52, 152, 219, 0.1);
            border-radius: 10px;
            border: 1px solid rgba(52, 152, 219, 0.2);
        }

        .metric-value {
            font-size: 1.5em;
            font-weight: bold;
            color: #3498db;
            margin-bottom: 5px;
        }

        .metric-label {
            color: #7f8c8d;
            font-size: 0.8em;
        }

        .chart-container {
            position: relative;
            height: 200px;
            margin-bottom: 20px;
        }

        .recent-events {
            max-height: 150px;
            overflow-y: auto;
            background: rgba(236, 240, 241, 0.5);
            border-radius: 10px;
            padding: 15px;
        }

        .event-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 0;
            border-bottom: 1px solid rgba(189, 195, 199, 0.3);
        }

        .event-item:last-child {
            border-bottom: none;
        }

        .event-time {
            color: #7f8c8d;
            font-size: 0.8em;
        }

        .event-details {
            color: #2c3e50;
            font-size: 0.9em;
        }

        .confidence-bar {
            width: 100%;
            height: 8px;
            background: rgba(189, 195, 199, 0.3);
            border-radius: 4px;
            overflow: hidden;
            margin-top: 10px;
        }

        .confidence-fill {
            height: 100%;
            background: linear-gradient(90deg, #e74c3c, #f39c12, #27ae60);
            border-radius: 4px;
            transition: width 0.3s ease;
        }

        .system-info {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 30px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .system-info h2 {
            color: #2c3e50;
            margin-bottom: 20px;
            text-align: center;
        }

        .info-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
        }

        .info-item {
            text-align: center;
            padding: 15px;
            background: rgba(52, 152, 219, 0.1);
            border-radius: 10px;
            border: 1px solid rgba(52, 152, 219, 0.2);
        }

        .info-value {
            font-size: 1.8em;
            font-weight: bold;
            color: #3498db;
            margin-bottom: 5px;
        }

        .info-label {
            color: #7f8c8d;
            font-size: 0.9em;
        }

        .refresh-indicator {
            position: fixed;
            top: 20px;
            right: 20px;
            background: rgba(46, 204, 113, 0.9);
            color: white;
            padding: 10px 15px;
            border-radius: 25px;
            font-size: 0.9em;
            box-shadow: 0 4px 15px rgba(46, 204, 113, 0.3);
            z-index: 1000;
        }

        .error-message {
            background: rgba(231, 76, 60, 0.9);
            color: white;
            padding: 15px;
            border-radius: 10px;
            margin: 20px;
            text-align: center;
            box-shadow: 0 4px 15px rgba(231, 76, 60, 0.3);
        }

        @media (max-width: 768px) {
            .agents-grid {
                grid-template-columns: 1fr;
            }
            
            .status-bar {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .metrics-grid {
                grid-template-columns: 1fr;
            }
            
            .header h1 {
                font-size: 2em;
            }
        }

        .pulse {
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.5; }
            100% { opacity: 1; }
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>🚀 Enhanced Telecom AI System</h1>
        <p>Advanced AI-powered network management with 6 specialized agents</p>
    </div>

    <div class="refresh-indicator" id="refreshIndicator">
        🔄 Auto-refresh: 5s
    </div>

    <div class="container">
        <!-- System Status Bar -->
        <div class="status-bar">
            <div class="status-card">
                <h3>System Status</h3>
                <div class="value" id="systemStatus">Loading...</div>
                <div class="label">Overall Health</div>
            </div>
            <div class="status-card">
                <h3>Events Processed</h3>
                <div class="value" id="eventsProcessed">0</div>
                <div class="label">Total Events</div>
            </div>
            <div class="status-card">
                <h3>Alerts Generated</h3>
                <div class="value" id="alertsGenerated">0</div>
                <div class="label">Active Alerts</div>
            </div>
            <div class="status-card">
                <h3>Optimizations</h3>
                <div class="value" id="optimizationsApplied">0</div>
                <div class="label">Applied</div>
            </div>
            <div class="status-card">
                <h3>Uptime</h3>
                <div class="value" id="systemUptime">0s</div>
                <div class="label">System Runtime</div>
            </div>
        </div>

        <!-- System Information -->
        <div class="system-info">
            <h2>📊 System Overview</h2>
            <div class="info-grid">
                <div class="info-item">
                    <div class="info-value" id="totalAgents">6</div>
                    <div class="info-label">AI Agents Active</div>
                </div>
                <div class="info-item">
                    <div class="info-value" id="messageBusStatus">Connected</div>
                    <div class="info-label">Message Bus</div>
                </div>
                <div class="info-item">
                    <div class="info-value" id="lastUpdate">--:--:--</div>
                    <div class="info-label">Last Update</div>
                </div>
                <div class="info-item">
                    <div class="info-value" id="apiPort">8080</div>
                    <div class="info-label">API Port</div>
                </div>
            </div>
        </div>

        <!-- AI Agents Grid -->
        <div class="agents-grid">
            <!-- QoS Anomaly Detection Agent -->
            <div class="agent-card">
                <div class="agent-header">
                    <div class="agent-icon qos-icon">📊</div>
                    <div>
                        <div class="agent-title">Enhanced QoS Anomaly Detection</div>
                        <div class="agent-subtitle">Isolation Forest + LSTM Autoencoder</div>
                    </div>
                </div>
                <div class="metrics-grid">
                    <div class="metric">
                        <div class="metric-value" id="qosAnomalies">0</div>
                        <div class="metric-label">Anomalies Detected</div>
                    </div>
                    <div class="metric">
                        <div class="metric-value" id="qosConfidence">0%</div>
                        <div class="metric-label">Model Confidence</div>
                    </div>
                </div>
                <div class="confidence-bar">
                    <div class="confidence-fill" id="qosConfidenceBar" style="width: 0%"></div>
                </div>
                <div class="recent-events" id="qosEvents">
                    <div class="event-item">
                        <div class="event-details">No recent anomalies</div>
                        <div class="event-time">--:--</div>
                    </div>
                </div>
            </div>

            <!-- Failure Prediction Agent -->
            <div class="agent-card">
                <div class="agent-header">
                    <div class="agent-icon failure-icon">⚠️</div>
                    <div>
                        <div class="agent-title">Advanced Failure Prediction</div>
                        <div class="agent-subtitle">Random Forest + Adaptive Learning</div>
                    </div>
                </div>
                <div class="metrics-grid">
                    <div class="metric">
                        <div class="metric-value" id="failurePredictions">0</div>
                        <div class="metric-label">Predictions Made</div>
                    </div>
                    <div class="metric">
                        <div class="metric-value" id="failureConfidence">0%</div>
                        <div class="metric-label">Model Confidence</div>
                    </div>
                </div>
                <div class="confidence-bar">
                    <div class="confidence-fill" id="failureConfidenceBar" style="width: 0%"></div>
                </div>
                <div class="recent-events" id="failureEvents">
                    <div class="event-item">
                        <div class="event-details">No recent predictions</div>
                        <div class="event-time">--:--</div>
                    </div>
                </div>
            </div>

            <!-- Traffic Forecast Agent -->
            <div class="agent-card">
                <div class="agent-header">
                    <div class="agent-icon traffic-icon">📈</div>
                    <div>
                        <div class="agent-title">Traffic Forecast</div>
                        <div class="agent-subtitle">Time Series Analysis + Prophet/LSTM</div>
                    </div>
                </div>
                <div class="metrics-grid">
                    <div class="metric">
                        <div class="metric-value" id="trafficForecasts">0</div>
                        <div class="metric-label">Forecasts Made</div>
                    </div>
                    <div class="metric">
                        <div class="metric-value" id="trafficConfidence">0%</div>
                        <div class="metric-label">Model Confidence</div>
                    </div>
                </div>
                <div class="confidence-bar">
                    <div class="confidence-fill" id="trafficConfidenceBar" style="width: 0%"></div>
                </div>
                <div class="recent-events" id="trafficEvents">
                    <div class="event-item">
                        <div class="event-details">No recent forecasts</div>
                        <div class="event-time">--:--</div>
                    </div>
                </div>
            </div>

            <!-- Energy Optimization Agent -->
            <div class="agent-card">
                <div class="agent-header">
                    <div class="agent-icon energy-icon">⚡</div>
                    <div>
                        <div class="agent-title">Energy Optimization</div>
                        <div class="agent-subtitle">Intelligent gNB Management</div>
                    </div>
                </div>
                <div class="metrics-grid">
                    <div class="metric">
                        <div class="metric-value" id="energyOptimizations">0</div>
                        <div class="metric-label">Optimizations Applied</div>
                    </div>
                    <div class="metric">
                        <div class="metric-value" id="energySavings">0W</div>
                        <div class="metric-label">Energy Saved</div>
                    </div>
                </div>
                <div class="confidence-bar">
                    <div class="confidence-fill" id="energyConfidenceBar" style="width: 0%"></div>
                </div>
                <div class="recent-events" id="energyEvents">
                    <div class="event-item">
                        <div class="event-details">No recent optimizations</div>
                        <div class="event-time">--:--</div>
                    </div>
                </div>
            </div>

            <!-- Security & Intrusion Detection Agent -->
            <div class="agent-card">
                <div class="agent-header">
                    <div class="agent-icon security-icon">🔒</div>
                    <div>
                        <div class="agent-title">Security & Intrusion Detection</div>
                        <div class="agent-subtitle">DBSCAN Clustering + Behavior Analysis</div>
                    </div>
                </div>
                <div class="metrics-grid">
                    <div class="metric">
                        <div class="metric-value" id="securityThreats">0</div>
                        <div class="metric-label">Threats Detected</div>
                    </div>
                    <div class="metric">
                        <div class="metric-value" id="securityConfidence">0%</div>
                        <div class="metric-label">Model Confidence</div>
                    </div>
                </div>
                <div class="confidence-bar">
                    <div class="confidence-fill" id="securityConfidenceBar" style="width: 0%"></div>
                </div>
                <div class="recent-events" id="securityEvents">
                    <div class="event-item">
                        <div class="event-details">No recent threats</div>
                        <div class="event-time">--:--</div>
                    </div>
                </div>
            </div>

            <!-- Data Quality Monitoring Agent -->
            <div class="agent-card">
                <div class="agent-header">
                    <div class="agent-icon quality-icon">✅</div>
                    <div>
                        <div class="agent-title">Data Quality Monitoring</div>
                        <div class="agent-subtitle">Automated Validation Pipeline</div>
                    </div>
                </div>
                <div class="metrics-grid">
                    <div class="metric">
                        <div class="metric-value" id="qualityIssues">0</div>
                        <div class="metric-label">Issues Detected</div>
                    </div>
                    <div class="metric">
                        <div class="metric-value" id="qualityConfidence">0%</div>
                        <div class="metric-label">Validation Accuracy</div>
                    </div>
                </div>
                <div class="confidence-bar">
                    <div class="confidence-fill" id="qualityConfidenceBar" style="width: 0%"></div>
                </div>
                <div class="recent-events" id="qualityEvents">
                    <div class="event-item">
                        <div class="event-details">No recent issues</div>
                        <div class="event-time">--:--</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Configuration
        const API_BASE_URL = window.location.origin.replace(/:\d+$/, ':8080');
        const REFRESH_INTERVAL = 5000; // 5 seconds
        let refreshTimer;

        // Utility functions
        function formatTime(seconds) {
            if (seconds < 60) return `${Math.floor(seconds)}s`;
            if (seconds < 3600) return `${Math.floor(seconds / 60)}m ${Math.floor(seconds % 60)}s`;
            return `${Math.floor(seconds / 3600)}h ${Math.floor((seconds % 3600) / 60)}m`;
        }

        function formatTimestamp(timestamp) {
            if (!timestamp) return '--:--';
            const date = new Date(timestamp);
            return date.toLocaleTimeString('en-US', { hour12: false, hour: '2-digit', minute: '2-digit' });
        }

        function updateConfidenceBar(elementId, confidence) {
            const bar = document.getElementById(elementId);
            if (bar) {
                const percentage = Math.round(confidence * 100);
                bar.style.width = `${percentage}%`;
            }
        }

        function updateRecentEvents(containerId, events, maxEvents = 5) {
            const container = document.getElementById(containerId);
            if (!container) return;

            if (!events || events.length === 0) {
                container.innerHTML = '<div class="event-item"><div class="event-details">No recent events</div><div class="event-time">--:--</div></div>';
                return;
            }

            const recentEvents = events.slice(-maxEvents).reverse();
            container.innerHTML = recentEvents.map(event => {
                const time = formatTimestamp(event.timestamp);
                const details = event.details || event.root_cause || event.threat_type || event.action || 'Event detected';
                return `<div class="event-item"><div class="event-details">${details}</div><div class="event-time">${time}</div></div>`;
            }).join('');
        }

        // API functions
        async function fetchSystemStatus() {
            try {
                const response = await fetch(`${API_BASE_URL}/status`);
                if (!response.ok) throw new Error(`HTTP ${response.status}`);
                return await response.json();
            } catch (error) {
                console.error('Error fetching system status:', error);
                return null;
            }
        }

        async function fetchTelecomMetrics() {
            try {
                const response = await fetch(`${API_BASE_URL}/telecom/metrics`);
                if (!response.ok) throw new Error(`HTTP ${response.status}`);
                return await response.json();
            } catch (error) {
                console.error('Error fetching telecom metrics:', error);
                return null;
            }
        }

        async function fetchAgentData(endpoint, agentName) {
            try {
                const response = await fetch(`${API_BASE_URL}/telecom/${endpoint}`);
                if (!response.ok) throw new Error(`HTTP ${response.status}`);
                return await response.json();
            } catch (error) {
                console.error(`Error fetching ${agentName} data:`, error);
                return null;
            }
        }

        // Update functions
        function updateSystemStatus(data) {
            if (!data) return;

            document.getElementById('systemStatus').textContent = data.system_status || 'Unknown';
            document.getElementById('eventsProcessed').textContent = data.events_processed || 0;
            document.getElementById('alertsGenerated').textContent = data.alerts_generated || 0;
            document.getElementById('optimizationsApplied').textContent = data.optimizations_applied || 0;
            document.getElementById('systemUptime').textContent = formatTime(data.uptime_seconds || 0);
            document.getElementById('messageBusStatus').textContent = data.message_bus_connected ? 'Connected' : 'Disconnected';
            document.getElementById('lastUpdate').textContent = new Date().toLocaleTimeString('en-US', { hour12: false });
        }

        function updateTelecomMetrics(data) {
            if (!data) return;

            const agentMetrics = data.agent_metrics || {};
            document.getElementById('qosAnomalies').textContent = agentMetrics.qos_anomalies || 0;
            document.getElementById('failurePredictions').textContent = agentMetrics.failure_predictions || 0;
            document.getElementById('trafficForecasts').textContent = agentMetrics.traffic_forecasts || 0;
            document.getElementById('energyOptimizations').textContent = agentMetrics.energy_optimizations || 0;
            document.getElementById('securityThreats').textContent = agentMetrics.security_threats || 0;
            document.getElementById('qualityIssues').textContent = agentMetrics.quality_issues || 0;
        }

        function updateAgentData(agentData, agentName) {
            if (!agentData) return;

            const status = agentData.status || {};
            const confidence = status.model_confidence || 0;
            const confidencePercentage = Math.round(confidence * 100);

            // Update confidence displays and bars
            const confidenceElement = document.getElementById(`${agentName}Confidence`);
            const confidenceBar = document.getElementById(`${agentName}ConfidenceBar`);
            
            if (confidenceElement) {
                confidenceElement.textContent = `${confidencePercentage}%`;
            }
            if (confidenceBar) {
                updateConfidenceBar(`${agentName}ConfidenceBar`, confidence);
            }

            // Update recent events
            const events = status.recent_anomalies || status.recent_predictions || status.recent_forecasts || 
                          status.recent_optimizations || status.recent_threats || status.recent_issues || [];
            updateRecentEvents(`${agentName}Events`, events);

            // Special handling for energy savings
            if (agentName === 'energy' && status.energy_savings !== undefined) {
                document.getElementById('energySavings').textContent = `${Math.round(status.energy_savings)}W`;
            }
        }

        // Main update function
        async function updateDashboard() {
            try {
                // Fetch all data in parallel
                const [systemStatus, telecomMetrics, qosData, failureData, trafficData, energyData, securityData, qualityData] = await Promise.all([
                    fetchSystemStatus(),
                    fetchTelecomMetrics(),
                    fetchAgentData('alerts', 'qos'),
                    fetchAgentData('predictions', 'failure'),
                    fetchAgentData('forecasts', 'traffic'),
                    fetchAgentData('energy', 'energy'),
                    fetchAgentData('security', 'security'),
                    fetchAgentData('quality', 'quality')
                ]);

                // Update dashboard elements
                updateSystemStatus(systemStatus);
                updateTelecomMetrics(telecomMetrics);
                updateAgentData(qosData, 'qos');
                updateAgentData(failureData, 'failure');
                updateAgentData(trafficData, 'traffic');
                updateAgentData(energyData, 'energy');
                updateAgentData(securityData, 'security');
                updateAgentData(qualityData, 'quality');

                // Update refresh indicator
                const indicator = document.getElementById('refreshIndicator');
                if (indicator) {
                    indicator.classList.add('pulse');
                    setTimeout(() => indicator.classList.remove('pulse'), 1000);
                }

            } catch (error) {
                console.error('Error updating dashboard:', error);
                showError('Failed to update dashboard data');
            }
        }

        function showError(message) {
            const errorDiv = document.createElement('div');
            errorDiv.className = 'error-message';
            errorDiv.textContent = message;
            document.body.insertBefore(errorDiv, document.body.firstChild);
            setTimeout(() => errorDiv.remove(), 5000);
        }

        // Initialize dashboard
        function initDashboard() {
            // Initial load
            updateDashboard();

            // Set up auto-refresh
            refreshTimer = setInterval(updateDashboard, REFRESH_INTERVAL);

            // Update refresh indicator
            let countdown = REFRESH_INTERVAL / 1000;
            const indicator = document.getElementById('refreshIndicator');
            
            const countdownTimer = setInterval(() => {
                countdown--;
                if (indicator) {
                    indicator.textContent = `🔄 Auto-refresh: ${countdown}s`;
                }
                if (countdown <= 0) {
                    countdown = REFRESH_INTERVAL / 1000;
                }
            }, 1000);
        }

        // Start the dashboard when page loads
        document.addEventListener('DOMContentLoaded', initDashboard);

        // Clean up on page unload
        window.addEventListener('beforeunload', () => {
            if (refreshTimer) {
                clearInterval(refreshTimer);
            }
        });
    </script>
</body>
</html>
